#!/bin/sh
###############################################################################
# BleemSync Bootstapper executor (child) v0.1
# ModMyClassic.com / https://discordapp.com/invite/8gygsrw
###############################################################################

### PROCESS COMMANDLINE ARGUMENTS #############################################
exe_queue=""
while [ $# -gt 0 ]; do
	[ "$1" == "--pretty-logo" ] && exe_queue="$exe_queue pretty_logo"
	[ "$1" == "--dump-emmc" ] && exe_queue="$exe_queue dump_emmc"
	[ "$1" == "--dump-fs" ] && exe_queue="$exe_queue dump_fs"
	[ "$1" == "--dump-tar" ] && exe_queue="$exe_queue dump_tar"
	[ "$1" == "--dump-fstruct" ] && exe_queue="$exe_queue dump_fstruct"
	[ "$1" == "--debug-run" ] && exe_queue="$exe_queue debug_run"
	[ "$1" == "--execute-bleemsync" ] && exe_queue="$exe_queue execute_bleemsync"
	shift
done
###############################################################################

### LOAD CONFIGURATION ########################################################
source /media/bleemsync/etc/bleemsync/CFG/bleemsync.cfg
### LOAD FUNCTION LIBRARIES ###################################################
source /media/bleemsync/etc/bleemsync/FUNC/0000_shared.funcs
source /media/bleemsync/etc/bleemsync/FUNC/0010_execute.funcs
source /media/bleemsync/etc/bleemsync/FUNC/0050_bleemsync.funcs
### EXECUTE ###################################################################
main(){
	for x in $exe_queue; do
		echo "$x" | grep -q "dump_" && [ "$force_redump" = "1" ] && $x"_func" --force && continue
		$x"_func"
	done 
}

main #Do stuff and things

#If we get here... Panic and Reboot
reboot
exit 1
###############################################################################

